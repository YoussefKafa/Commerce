{% extends "auctions/layout.html" %}

{% block body %}
    <a href="{% url 'newListing' %}" >create new listing</a>
    <h2>Active Listings</h2>
    {% if user.is_authenticated %}
    {% if bidError %}
    <h1 style="color:red">Please notice that : </h1>
    <h3 style="color:rgb(245, 94, 131)">
        The bid must be at least as large as the starting bid, and must be greater than any other bids that have been placed
    </h3>
    {% endif %}
    <ul>
        {% for listing in listings %}
        <li>title : {{listing.title}} <br> 
            Description : {{listing.description}}<br>
            Starting Bid : {{listing.startingBid}} <br>
            Bid History : {{listing.bidHistory}} <br>
            Highest Bid : {{listing.lastBid}} <br>
            {% if listing.closed %}
            Winner : {{listing.winner}} <br>
            {% endif %}
            Image :<br> 
        {% if listing.image %}
            <img src="{{listing.image.url}}" alt="Bid pic" width="250" height="250">
        {% else %}
            no image
        {%endif %}
            <br>
            <a href="listingMainPage/{{listing.id}}">View details</a>
            <br>
            {% if listing.winner.id == current_user%}
            <h1 style="color:green">You are the winner!</h1>
            {% endif %}
            <br>
            {% if listing.closed %}
            <h1 style="color:red">Closed</h1>
            {% else %}
            {% if listing.watched %}
            <a href="removeFromWatchList/{{listing.id}}" style="color:red">
                Remove from WatchList.
               </a>
        {% else %}
        <a href="addToWatchList/{{listing.id}}" style="color:rgb(139, 2, 128)">
            Add to WatchList.
           </a>
        {% endif %}
        <br>
        <form action="{% url 'bid' %}" method="post" enctype='multipart/form-data'>
            {% csrf_token %}
            <input type="text" name="listing" value="{{listing.id}}" hidden="true">
            <input type="number" name="amount" value="Enter a number to Bid!" onfocus="this.value=''">
            <input type="submit" name="submit" value="Bid!" style="color:white; background-color: #04AA6D;">
        </form>
        {% if owner %}
        <a href="close/{{listing.id}}" style="color:red">
            Close.
           </a>
        {% else %}
        {% endif %}
        </li>
        <hr style="border: 2px solid rgb(88, 88, 88); border-radius: 5px;">
        {% endif %}
        {% empty %}
        <h2>There is no listings available.</h2>
        {% endfor %}
    </ul>
    {% else %}
    <h1>Please login to see all the listings.</h1>
    {% endif %}
  
{% endblock %}